<!DOCTYPE html>
<html lang="de">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>P.I.X.I.</title>

    <!-- Fonts & Icons -->
    <link
        href="https://fonts.googleapis.com/css2?family=Syncopate:wght@400;700&family=Inter:wght@100;300;400;600&display=swap"
        rel="stylesheet">
    <link rel="stylesheet"
        href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:wght,FILL@100..700,0..1&display=swap" />

    <!-- CSS -->
    <link rel="stylesheet" href="/static/css/style.css?v={{ range(1, 9999) | random }}">
    <link rel="manifest" href="/manifest.json">
    <meta name="theme-color" content="#0a0a0c">
</head>

<body>
    <div class="nebula-bg"></div>

    <div class="app-container">
        <header class="glass">
            <div class="logo">P.I.X.I.</div>

            <div class="header-actions">
                <button class="btn-action" onclick="document.getElementById('file-input').click()">
                    <span class="material-symbols-outlined">add_circle</span>
                    UPLOAD
                </button>
                <button class="btn-action" onclick="toggleGridSettings()">
                    <span class="material-symbols-outlined">grid_view</span>
                </button>
                <div id="grid-settings" class="glass grid-settings-popup">
                    <label>SPALTEN: <span id="grid-col-val">3</span></label>
                    <input type="range" id="grid-col-range" min="1" max="6" value="3"
                        oninput="updateGridCols(this.value)">
                </div>
                <button class="btn-action" onclick="toggleFavorites()">
                    <span class="material-symbols-outlined {% if favorites %}fill-1{% endif %}">favorite</span>
                    {{ "ALLE" if favorites else "FAVORITEN" }}
                </button>
            </div>
        </header>

        <main class="gallery-grid" id="gallery">
            {% if not images %}
            <div class="empty-state">
                <span class="material-symbols-outlined">photo_library</span>
                <p>DEINE GALERIE IST NOCH LEER</p>
                <button class="btn-action" onclick="document.getElementById('file-input').click()">ERSTEN MOMENT
                    HOCHLADEN</button>
            </div>
            {% endif %}
            {% for image in images %}
            <div class="image-card glass animate-in" data-id="{{ image.id }}"
                onclick="openViewer('{{ image.id }}', '{{ image.filename }}', '{{ image.media_type }}')">

                <button class="btn-fav {% if image.is_favorite %}active{% endif %}"
                    onclick="event.stopPropagation(); toggleFavorite('{{ image.id }}', this)">
                    <span class="material-symbols-outlined fill-1">favorite</span>
                </button>

                <img src="/thumbnails/{{ image.filename }}.webp" alt="Memory" class="card-img" loading="lazy">

                <div class="card-overlay">
                    <div class="card-meta">
                        <div class="card-title">PRIVATE MOMENT</div>
                        <div class="card-date">{{ image.upload_date.strftime('%d. %b %Y') if image.upload_date else
                            'ZEITLOS' }}</div>
                    </div>
                </div>

                {% if image.media_type == 'video' %}
                <div class="video-indicator">
                    <span class="material-symbols-outlined">play_circle</span>
                </div>
                {% endif %}
            </div>
            {% endfor %}
        </main>
    </div>

    <!-- Hidden File Input -->
    <input type="file" id="file-input" multiple accept="image/*,video/*" style="display: none;"
        onchange="handleFiles(this.files)">

    <!-- Immersive Viewer Modal -->
    <div class="modal-overlay" id="viewer-modal" onclick="closeViewer()">
        <button class="modal-close" onclick="closeViewer()">
            <span class="material-symbols-outlined">close</span>
        </button>
        <div class="modal-content" onclick="event.stopPropagation()">
            <button class="nav-arrow nav-prev" onclick="prevMedia()">
                <span class="material-symbols-outlined">chevron_left</span>
            </button>
            <div class="modal-image-wrapper">
                <img id="viewer-img" src="" alt="Full View" class="modal-image">
                <video id="viewer-video" class="modal-image" controls style="display: none;"></video>
            </div>
            <button class="nav-arrow nav-next" onclick="nextMedia()">
                <span class="material-symbols-outlined">chevron_right</span>
            </button>

            <div class="viewer-controls glass">
                <button class="btn-action" id="viewer-fav-btn" onclick="toggleViewerFavorite()">
                    <span class="material-symbols-outlined">favorite</span>
                </button>
                <button class="btn-action" id="slideshow-toggle" onclick="toggleSlideshow()">
                    <span class="material-symbols-outlined">play_circle</span>
                </button>
                <button class="btn-action" onclick="toggleSlideshowSettings()">
                    <span class="material-symbols-outlined">settings</span>
                </button>
                <button class="btn-action" onclick="downloadCurrent()">
                    <span class="material-symbols-outlined">download</span>
                </button>
                <button class="btn-action btn-delete" onclick="deleteCurrent()" style="color: #ff4757;">
                    <span class="material-symbols-outlined">delete</span>
                </button>
            </div>

            <!-- Slideshow Settings Panel -->
            <div id="ss-settings" class="glass ss-settings-panel">
                <div class="ss-settings-header">
                    <h3>DIASHOW SETTINGS</h3>
                    <button onclick="toggleSlideshowSettings()">&times;</button>
                </div>
                <div class="ss-setting-item">
                    <label>INTERVALL (SEK): <span id="ss-interval-val">3</span>s</label>
                    <input type="range" id="ss-interval-range" min="1" max="10" value="3"
                        oninput="updateIntervalLabel(this.value)">
                </div>
                <div class="ss-setting-item">
                    <label>EFFEKT</label>
                    <select id="ss-effect-select">
                        <option value="fade">FADE</option>
                        <option value="zoom">ZOOM</option>
                        <option value="slide">SLIDE</option>
                        <option value="none">KEINER</option>
                    </select>
                </div>
            </div>
        </div>
    </div>

    <!-- Notification Toast -->
    <div id="toast-container"></div>

    <script src="/static/js/app.js?v={{ range(1, 9999) | random }}"></script>
</body>

</html>